/* 
This file is part of MetExploreViz 
 
Copyright (c) 2016 INRA 
 
Contact: http://metexplore.toulouse.inra.fr/metexploreViz/doc/contact 
 
GNU General Public License Usage 
This file may be used under the terms of the GNU General Public License version 3.0 as 
published by the Free Software Foundation and appearing in the file LICENSE included in the 
packaging of this file. 
 
Please review the following information to ensure the GNU General Public License version 3.0 
requirements will be met: http://www.gnu.org/copyleft/gpl.html. 
 
If you are unsure which license is appropriate for your use, please contact us 
at http://metexplore.toulouse.inra.fr/metexploreViz/doc/contact 
 
Version: 1 Build date: 2016-04-13 9:34:37 
*/ 
var metExploreD3={GraphUtils:"",GraphCaption:"",GraphNetwork:"",GraphLink:"",GraphFunction:"",GraphMapping:"",GraphPanel:"",GraphPath:"",GraphNode:"",testWSMappingGraphToken:function(c,b,a,d){var e={token:c,Content:b,pathways:a};Ext.Ajax.request({method:"POST",url:"http://metexplore.toulouse.inra.fr:8080/metExploreWebService/mapping/launchtokenmapping/inchi/1363/filteredbypathways/",jsonData:e,success:function(f,g){var h=Ext.decode(f.responseText);d(h)},failure:function(f,g){console.log(f)}})},testWSMappingPathways:function(a,b){var c={token:"",Content:a};Ext.Ajax.request({method:"POST",url:"http://metexplore.toulouse.inra.fr:8080/metExploreWebService/mapping/launchtokenmapping/inchi/1363/aspathways/",jsonData:c,success:function(d,e){var f=Ext.decode(d.responseText);b(f)},failure:function(d,e){console.log(d)}})},testWSMappingGraph:function(b,d,c){var a="";d.forEach(function(f){a+=f;if(d.indexOf(f)!=d.length-1){a+=","}});var e={token:"",Content:b,pathways:"("+a+")"};Ext.Ajax.request({method:"POST",url:"http://metexplore.toulouse.inra.fr:8080/metExploreWebService/mapping/launchtokenmapping/inchi/1363/filteredbypathways/",jsonData:e,success:function(f,g){var h=Ext.decode(f.responseText);c(h)},failure:function(f,g){console.log(f)}})},resetMetExploreViz:function(){metExploreD3.fireEvent("selectConditionForm","resetMapping");metExploreD3.fireEvent("graphPanel","initSearch");if(_metExploreViz.getMappingsLength()>0&&d=="viz"){metExploreD3.fireEventArg("buttonMap","reloadMapping",false);metExploreD3.fireEventArg("buttonRefresh","reloadMapping",false);_metExploreViz.resetMappings()}var c=Ext.getCmp("comparisonSidePanel");if(c!=undefined){c.collapse()}if(Ext.getCmp("maskInit")!=undefined){var a=Ext.getCmp("maskInit");a.show();Ext.getCmp("buttonImportToNetworkFromWebsite").setDisabled(true)}var e=_metExploreViz.getSessionsSet();for(var d in e){if(e[d].getForce()!=undefined){e[d].getForce().on("end",null);e[d].getForce().stop()}if(e[d].getId()!="viz"){if(Ext.getCmp(e[d].getId().replace("-body",""))!=null){Ext.getCmp(e[d].getId().replace("-body","")).destroy()}}}d3.select("#viz").select("#D3viz").remove();_metExploreViz.sessions={};_metExploreViz.launched=false;_metExploreViz.dataFromWebSite=null;_metExploreViz.initialData=undefined;_metExploreViz.comparedPanels=[];_metExploreViz.mappings=[];_metExploreViz.linkedByTypeOfMetabolite=false;_metExploreViz.oldCoodinates=[];var b=new NetworkVizSession();b.setVizEngine("D3");b.setId("viz");b.setMapped("false");b.setDisplayNodeName("name");_metExploreViz.addSession(b)},getGlobals:function(){return _metExploreViz},newNetworkData:function(a){return new NetworkData(a)},newGeneralStyle:function(c,e,i,g,h,f,b,d,a){return new GeneralStyle(c,e,i,g,h,f,b,d,a)},getCompartmentInBiosourceSet:function(){return _metExploreViz.getSessionById("viz").getD3Data().getCompartments()},sortCompartmentInBiosource:function(){_metExploreViz.getSessionById("viz").getD3Data().sortCompartments()},getCompartmentInBiosourceLength:function(){return _metExploreViz.getSessionById("viz").getD3Data().getCompartmentsLength()},getCompartmentsGroup:function(){var c=[];var i=Math.ceil(Math.sqrt(metExploreD3.getCompartmentInBiosourceLength()));var e=parseInt(metExploreD3.GraphPanel.getHeight("viz"));var g=parseInt(metExploreD3.GraphPanel.getWidth("viz"));var k=e/i;var b=g/i;var j=k/2;var f=b/2;var d=-1;metExploreD3.getCompartmentInBiosourceSet().forEach(function(m){var l=metExploreD3.getCompartmentInBiosourceSet().indexOf(m)%i;if(l==0){d++}var n=f+(l*b);var o=j+(d*k);var h={key:m.getIdentifier(),center:{x:n,y:o}};c.push(h)});function a(l,h){if(h!=undefined){if(h.values==undefined){h.values=[]}if(h.values.indexOf(l)==-1){h.values.push(l)}}}_metExploreViz.getSessionById("viz").getD3Data().getLinks().forEach(function(m){var h=m.source;var l=m.target;if(h.getBiologicalType()=="metabolite"){a(h,c.find(function(n){return n.key==h.getCompartment()}));a(l,c.find(function(n){return n.key==h.getCompartment()}))}else{a(h,c.find(function(n){return n.key==l.getCompartment()}));a(l,c.find(function(n){return n.key==l.getCompartment()}))}});return c},getPathwaysSet:function(){return _metExploreViz.getSessionById("viz").getD3Data().getPathways()},getPathwaysGroup:function(){var c=[];var i=Math.ceil(Math.sqrt(metExploreD3.getPathwaysLength()));var e=parseInt(metExploreD3.GraphPanel.getHeight("viz"));var g=parseInt(metExploreD3.GraphPanel.getWidth("viz"));var k=e/i;var b=g/i;var j=k/2;var f=b/2;var d=-1;metExploreD3.getPathwaysSet().forEach(function(l){var m=metExploreD3.getPathwaysSet().indexOf(l)%i;if(m==0){d++}var n=f+(m*b);var o=j+(d*k);var h={key:l,center:{x:n,y:o}};c.push(h)});function a(l,h){if(h!=undefined){if(h.values==undefined){h.values=[]}if(h.values.indexOf(l)==-1){h.values.push(l)}}}_metExploreViz.getSessionById("viz").getD3Data().getLinks().forEach(function(m){var h=m.source;var l=m.target;if(h.getBiologicalType()=="reaction"){h.getPathways().forEach(function(n){a(h,c.find(function(o){return o.key==n}));a(l,c.find(function(o){return o.key==n}))})}else{l.getPathways().forEach(function(n){a(h,c.find(function(o){return o.key==n}));a(l,c.find(function(o){return o.key==n}))})}});return c},sortPathways:function(){_metExploreViz.getSessionById("viz").getD3Data().sortPathways()},getPathwaysLength:function(){return _metExploreViz.getSessionById("viz").getD3Data().getPathwaysLength()},setScale:function(b,a){_metExploreViz.getSessionById(a).setScale(b)},getScaleById:function(a){return _metExploreViz.getSessionById(a).getScale()},setMetabolitesSet:function(a){Ext.getStore("S_Metabolite")=a},getMetabolitesSet:function(){return Ext.getStore("S_Metabolite")},getMetaboliteById:function(a,b){return a.getById(b)},setReactionsSet:function(a){Ext.getStore("S_Reaction")=a},getReactionsSet:function(){return Ext.getStore("S_Reaction")},getReactionById:function(a,b){return a.getById(b)},setReactionStyle:function(a){_metExploreViz.reactionStyle=a;metExploreD3.fireEvent("reactionStyleForm","setReactionStyle")},getReactionStyle:function(){return _metExploreViz.reactionStyle},getGeneralStyle:function(){return _metExploreViz.generalStyle},setGeneralStyle:function(a){_metExploreViz.generalStyle=a;console.log("setGeneralStyle");metExploreD3.fireEvent("generalStyleForm","setGeneralStyle");metExploreD3.fireEvent("vizIdConvexHullMenu","setGeneralStyle");metExploreD3.fireEvent("buttonImportToNetworkFromWebsite","setGeneralStyle")},setMetaboliteStyle:function(a){_metExploreViz.metaboliteStyle=a;metExploreD3.fireEvent("metaboliteStyleForm","setMetaboliteStyle")},getMetaboliteStyle:function(){return _metExploreViz.metaboliteStyle},setLinkStyle:function(a){_metExploreViz.linkStyle=a},getLinkStyle:function(){return _metExploreViz.linkStyle},setConditionsSet:function(a){Ext.getStore("S_Condition")=a},getConditionsSet:function(){return Ext.getStore("S_Condition")},getConditionById:function(a,b){return a.getById(b)},getConditionsSetLength:function(a){return a.getCount()},setMappingInfosSet:function(a){Ext.getStore("S_MappingInfo")=a},getMappingInfosSet:function(){return Ext.getStore("S_MappingInfo")},getMappingInfoById:function(a,b){return a.getById(b)},findMappingInfo:function(b,c,a){return b.findRecord(c,a)},newReactionMapStore:function(a){return Ext.create("Ext.data.Store",{fields:["id","ec","name","reversible"]})},addReactionMap:function(e,b,d,c,a){e.add({id:b,ec:d,name:c,reversible:a})},getReactionMapsSetLength:function(a){return a.getCount()},getMappingSelection:function(){var a=Ext.getCmp("selectMappingVisu");return a.getValue()},showMask:function(a){a.show()},hideMask:function(a){a.hide()},createLoadMask:function(b,a){if(a!="viz"){var c=a.substring(0,a.length-5)}else{var c=a}if(c!=undefined){return new Ext.LoadMask({target:Ext.getCmp(c),msg:b,msgCls:"msgClsCustomLoadMask"})}else{return undefined}},createDelayedTask:function(a){return new Ext.util.DelayedTask(a)},fixDelay:function(a,b){a.delay(b)},stopTask:function(a){a.cancel()},fireEvent2Arg:function(e,d,c,a){var b=Ext.getCmp(e);if(b!=undefined){b.fireEvent(d,c,a)}},fireEventArg:function(d,c,a){var b=Ext.getCmp(d);if(b!=undefined){b.fireEvent(c,a)}},fireEvent:function(c,b){var a=Ext.getCmp(c);if(a!=undefined){a.fireEvent(b)}},hideInitialMask:function(b){var a=Ext.getCmp("buttonImportToNetworkFromWebsite");if(a!=undefined){a.fireEvent("hideMask")}},hideInitialLoadButtons:function(b){var a=Ext.getCmp("buttonImportToNetworkFromWebsite");if(a!=undefined){a.fireEvent("hideInitialLoadButtons")}},cartFilled:function(b){var a=Ext.getCmp("buttonImportToNetworkFromWebsite");if(a!=undefined){a.fireEvent("cartFilled")}a=Ext.getCmp("viz_LoadMenu");if(a!=undefined){a.fireEvent("cartFilled")}_metExploreViz.setDataFromWebSite(b)},fireEventParentWebSite:function(b,a){var c=new Event(b,a);c.value=a;_metExploreViz.getParentWebSite().document.dispatchEvent(c)},displayMessage:function(a,b){Ext.Msg.alert(a,b)},displayMessageOK:function(a,c,b){Ext.Msg.show({title:a,msg:c,buttons:Ext.Msg.OKCANCEL,fn:b,icon:Ext.Msg.QUESTION})},displayMessageYesNo:function(a,c,b){Ext.Msg.confirm(a,c,b)},deferFunction:function(a,b){return new Ext.defer(a,b)},launchMetexploreFunction:function(a){if(_metExploreViz.getSessionById("viz")!=="undefined"){if(typeof _metExploreViz.getSessionById("viz").getForce()!=="undefined"){a();return}}setTimeout(function(){metExploreD3.launchMetexploreFunction(a)},1000)},onloadSession:function(a){metExploreD3.launchMetexploreFunction(a)},launchMetexploreMapping:function(b,a){if(_metExploreViz.getMappingByName(b)!=null){a();return}setTimeout(function(){metExploreD3.launchMetexploreMapping(b,a)},1000)},onloadMapping:function(b,a){metExploreD3.launchMetexploreMapping(b,a)}};var _metExploreViz;var metExploreViz=function(b,a){_metExploreViz=this;this.sessions={};this.launched=false;this.dataFromWebSite=null;this.panel=b;this.linkStyle=new LinkStyle(25,2,5,5,"red","green","black","0.7","black");this.reactionStyle=new ReactionStyle(10,20,3,3,"ec",8,"black",1);this.metaboliteStyle=new MetaboliteStyle(10,10,5,5,6,1,"name","#b2ae92");this.generalStyle=new GeneralStyle("Website","yellow","blue",500,false,false,false,false,false);this.initialData=undefined;this.comparedPanels=[];this.mappings=[];this.linkedByTypeOfMetabolite=false;this.parentWebSite=a;this.oldCoodinates=[];metExploreD3.fireEventArg("networkPanel","afterlunch",b);this.generalStyle.setWindowsAlertDisable(true)};metExploreViz.prototype={getDataFromWebSite:function(){return this.dataFromWebSite},setDataFromWebSite:function(a){this.dataFromWebSite=a},getParentWebSite:function(){return this.parentWebSite},cloneNetworkData:function(b){var g=new NetworkData();var o,y,t,s,d,k,w,a,u,p,c,i,l,v;for(var q=0;q<b.nodes.length;q++){o=b.nodes[q];if(o.getName()!=undefined){y=o.getName().valueOf()}else{y=undefined}if(o.getCompartment()!=undefined){t=o.getCompartment().valueOf()}else{t=undefined}if(o.getDbIdentifier()!=undefined){s=o.getDbIdentifier().valueOf()}else{s=undefined}if(o.getEC()!=undefined){d=o.getEC().valueOf()}else{d=undefined}if(o.getId()!=undefined){k=o.getId().valueOf()}else{k=undefined}if(o.getReactionReversibility()!=undefined&&o.getBiologicalType()=="reaction"){w=o.getReactionReversibility().valueOf()}else{w=undefined}if(o.getIsSideCompound()!=undefined){a=o.getIsSideCompound().valueOf()}else{a=undefined}if(o.getBiologicalType()!=undefined){u=o.getBiologicalType().valueOf()}else{u=undefined}if(o.isSelected()!=undefined){p=o.isSelected().valueOf()}else{p=undefined}if(o.getLabelVisible()!=undefined){c=o.getLabelVisible().valueOf()}else{c=undefined}if(o.getSvg()!=undefined){i=o.getSvg().valueOf()}else{i=undefined}if(o.getSvgWidth()!=undefined){l=o.getSvgWidth().valueOf()}else{l=undefined}if(o.getSvgHeight()!=undefined){v=o.getSvgHeight().valueOf()}else{v=undefined}g.addNode(y,t,s,k,w,u,p,c,i,l,v,a,d)}for(var q=0;q<b.links.length;q++){var k=b.links[q].getId().valueOf();var f=b.links[q].getSource();var m=g.nodes[f];var r=b.links[q].getTarget();var x=g.nodes[r];var e=b.links[q].getInteraction().valueOf();var h=b.links[q].isReversible().valueOf();g.links[q]=new LinkData(k,m,x,e,h)}return g},cloneSession:function(){var h=this.getSessionById("viz");var b=new NetworkVizSession();b.reset();var f,c,l,j,m,d,k,p,q,e,g,i,a,o;h.getD3Data().getNodes().forEach(function(t){if(t.getName()!=undefined){c=t.getName().valueOf()}else{c=undefined}if(t.getCompartment()!=undefined){l=t.getCompartment().valueOf()}else{l=undefined}if(t.getDbIdentifier()!=undefined){j=t.getDbIdentifier().valueOf()}else{j=undefined}if(t.getEC()!=undefined){m=t.getEC().valueOf()}else{m=undefined}if(t.getId()!=undefined){d=t.getId().valueOf()}else{d=undefined}if(t.getReactionReversibility()!=undefined&&t.getBiologicalType()=="reaction"){k=t.getReactionReversibility().valueOf()}else{k=undefined}if(t.getIsSideCompound()!=undefined){p=t.getIsSideCompound().valueOf()}else{p=undefined}if(t.getBiologicalType()!=undefined){q=t.getBiologicalType().valueOf()}else{q=undefined}if(t.isSelected()!=undefined){e=t.isSelected().valueOf()}else{e=undefined}if(t.getLabelVisible()!=undefined){g=t.getLabelVisible().valueOf()}else{g=undefined}if(t.getSvg()!=undefined){i=t.getSvg().valueOf()}else{i=undefined}if(t.getSvgWidth()!=undefined){a=t.getSvgWidth().valueOf()}else{a=undefined}if(t.getSvgHeight()!=undefined){o=t.getSvgHeight().valueOf()}else{o=undefined}if(t.getIdentifier()!=undefined){identif=t.getIdentifier().valueOf()}else{identif=undefined}var r=false;if(t.isDuplicated()!=undefined){r=t.isDuplicated().valueOf()}else{r=false}var s=b.d3Data.addNode(c,l,j,d,k,q,e,g,i,a,o,p,m,r,identif)});h.getD3Data().getLinks().forEach(function(r){var x=r.getId().valueOf();var v=r.getSource();var s=b.d3Data.nodes[h.getD3Data().getNodes().indexOf(v)];var w=r.getTarget();var u=b.d3Data.nodes[h.getD3Data().getNodes().indexOf(w)];var n=r.getInteraction().valueOf();var t=r.isReversible().valueOf();b.d3Data.addLink(x,s,u,n,t)});return b},getGeneralStyle:function(){return this.generalStyle},getMetaboliteStyle:function(){return this.metaboliteStyle},addSession:function(a){this.sessions[a.getId()]=a},getSessionsSet:function(){return this.sessions},getSessionById:function(a){return this.sessions[a]},getSessionsLength:function(){return this.sessions.length},removeSession:function(a){if(this.sessions[a]!=undefined){delete this.sessions[a]}},getInitialData:function(){return this.initialData},setInitialData:function(a){this.initialData=a},isLaunched:function(){return this.launched},setLaunched:function(a){this.launched=a},addComparedPanel:function(a){this.comparedPanels.push(a)},removeComparedPanel:function(b){var c=false;var a=0;while(!c){if(this.comparedPanels[a].getPanel()==b.getPanel()){this.comparedPanels.splice(a,1);c=true}a++}},getComparedPanelsLength:function(){return this.comparedPanels.length},getComparedPanelById:function(b){var a=null;this.comparedPanels.forEach(function(c){if(c.getPanel()==b){a=c}});return a},getOldCoodinates:function(){return this.oldCoodinates},addOldCoodinates:function(a){this.oldCoodinates.push(a)},resetOldCoodinates:function(){this.oldCoodinates=[]},getMappingsSet:function(){return this.mappings},addMapping:function(a){if(this.getMappingByName(a.getName())!=null){a.setName(a.getName()+"I");this.addMapping(a)}else{this.mappings.push(a)}},resetMappings:function(a){this.mappings=[];_metExploreViz.getSessionById("viz").getD3Data().resetMapping()},removeMapping:function(c){var b=false;var a=0;while(!b&&a<this.mappings.length){if(this.mappings[a].getName()==c){this.mappings.splice(a,1);b=true}a++}},getMappingsLength:function(){return this.mappings.length},getMappingByName:function(b){var a=null;this.mappings.forEach(function(c){if(c.getName()==b){a=c}});return a},isLinkedByTypeOfMetabolite:function(){return this.linkedByTypeOfMetabolite},setLinkedByTypeOfMetabolite:function(a){this.linkedByTypeOfMetabolite=a}};