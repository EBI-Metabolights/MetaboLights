metExploreD3.GraphPath={panelParent:"",delayedInitialisation:function(a){metExploreD3.GraphLink.panelParent=a},refreshLink:function(c,g,b,f){metExploreD3.GraphLink.panelParent="#"+c;var e=g.getD3Data();var a=20;var d=b.getMarkerWidth()/2;d3.select("#"+c).select("#D3viz").select("#graphComponent").append("svg:defs").selectAll("marker").data(["in","out"]).enter().append("svg:marker").attr("id",String).attr("viewBox","0 0 "+b.getMarkerWidth()+" "+b.getMarkerHeight()).attr("refY",d).attr("markerWidth",b.getMarkerWidth()).attr("markerHeight",b.getMarkerHeight()).attr("orient","auto").append("svg:path").attr("class",String).attr("d","M0,0L"+b.getMarkerWidth()+","+b.getMarkerHeight()/2+"L0,"+b.getMarkerWidth()+"Z").style("visibility","hidden");metExploreD3.GraphLink.link=d3.select("#"+c).select("#D3viz").select("#graphComponent").selectAll("line").data(e.getLinks()).enter().append("line").attr("class","link").attr("marker-end",function(h){if(h.interaction=="out"){d3.select("#"+c).select("#D3viz").select("#graphComponent").select("#"+h.interaction).attr("refX",(f.getWidth()+f.getHeight())/2/2+(b.getMarkerWidth())).style("fill",b.getMarkerOutColor()).style("stroke",b.getMarkerStrokeColor()).style("stroke-width",b.getMarkerStrokeWidth());return"url(#"+h.interaction+")"}else{return"none"}}).attr("marker-start",function(h){if(h.interaction=="out"){return"none"}else{d3.select("#"+c).select("#D3viz").select("#graphComponent").select("#"+h.interaction).attr("refX",-((f.getWidth()+f.getHeight())/2/2)).style("fill",b.getMarkerInColor()).style("stroke",b.getMarkerStrokeColor()).style("stroke-width",b.getMarkerStrokeWidth());return"url(#"+h.interaction+")"}}).style("stroke",b.getStrokeColor())},tick:function(a,b){d3.select("#"+a).select("#D3viz").selectAll("path").filter(function(c){return c!="in"&&c!="out"}).attr("d",metExploreD3.GraphPath.groupPath).attr("transform",d3.select("#"+a).select("#D3viz").select("#graphComponent").attr("transform"))},loadPath:function(c){d3.select("#"+c).select("#D3viz").select("#graphComponent").selectAll("g.node");var b=metExploreD3.GraphPath.node.filter(function(e){return e.getBiologicalType()=="metabolite"});session.groups=d3.nest().key(function(e){return e.getCompartment()}).entries(b.data());metExploreD3.GraphPath.groupPath=function(k){var j=metExploreD3.getScaleById("viz");if(k.values.length>0){if(k.values.length>2){return"M"+d3.geom.hull(k.values.map(function(d){return[d.x,d.y]})).join("L")+"Z"}else{var h=[];k.values.forEach(function(d){h.push([d.x,d.y])});var f,e;for(var g=k.values.length;g<3;g++){f=k.values[0].x*(1+0.00001*g);e=k.values[0].y*(1+0.000011*g);h.push([f,e])}return"M"+d3.geom.hull(h).join("L")+"Z"}}};metExploreD3.GraphPath.groupFill=function(h,g){metExploreD3.sortCompartmentInBiosource();var e;for(var f=0;f<metExploreD3.getCompartmentInBiosourceLength();f++){if(h.key==metExploreD3.getCompartmentInBiosourceSet()[f].getIdentifier()){e=metExploreD3.getCompartmentInBiosourceSet()[f].getColor()}}return e};var a="M0,0L10,10Z";d3.select("#"+c).select("#D3viz").selectAll("path").filter(function(e){return e!="in"&&e!="out"}).data(session.groups).attr("d",function(e){return a}).enter().insert("path",":first-child").attr("class",function(e){return e.key}).attr("id",function(e){return e.key}).style("fill",metExploreD3.GraphPath.groupFill).style("stroke",metExploreD3.GraphPath.groupFill).style("stroke-width",40).style("stroke-linejoin","round").style("opacity",0.15)}};